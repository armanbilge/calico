<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Laika 0.18.1 + Helium Theme" />
    <title>Core Concepts</title>
    
      <meta name="author" content="Arman Bilge"/>
    
    
      <meta name="description" content="docs"/>
    
    
      <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
    
    <link rel="stylesheet" type="text/css" href="helium/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="helium/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="site/calico-styles.css" />
    <link rel="stylesheet" type="text/css" href="site/styles.css" />
    <script src="helium/laika-helium.js"></script>
    
    
    <script> /* for avoiding page load transitions */ </script>
  </head>

  <body>

    <header id="top-bar">

      <div class="row">
        <a id="nav-icon">
          <i class="icofont-laika" title="Navigation">&#xefa2;</i>
        </a>
        
      </div>

      <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

      <span class="row links"><a class="icon-link svg-link" href="https://www.javadoc.io/doc/com.armanbilge/calico-docs_sjs1_3/0.2.0-RC2/calico/index.html"><span title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a><a class="icon-link svg-link" href="https://github.com/armanbilge/calico"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a><a class="icon-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika" title="Chat">&#xeed5;</i></a><a class="icon-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon svg-link" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg>
</span></a></span>

    </header>

    <nav id="sidebar">

      <div class="row">
        <a class="icon-link svg-link" href="https://www.javadoc.io/doc/com.armanbilge/calico-docs_sjs1_3/0.2.0-RC2/calico/index.html"><span title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a><a class="icon-link svg-link" href="https://github.com/armanbilge/calico"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a><a class="icon-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika" title="Chat">&#xeed5;</i></a><a class="icon-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon svg-link" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg>
</span></a>
      </div>

      <ul class="nav-list">
        <li class="level1"><a href="index.html">Calico</a></li>
        <li class="level1 active"><a href="#">Core Concepts</a></li>
        <li class="level1"><a href="iowebapp.html">IOWebApp</a></li>
        <li class="level1"><a href="router.html">Router</a></li>
        <li class="level1 nav-header">demos</li>
        <li class="level2"><a href="demos/hello-world.html">Hello World</a></li>
        <li class="level2"><a href="demos/counter.html">Counter</a></li>
        <li class="level2"><a href="demos/time.html">Time</a></li>
        <li class="level2"><a href="demos/todomvc.html">TodoMVC</a></li>
        <li class="level2"><a href="demos/http4s.html">http4s</a></li>
      </ul>

      <ul class="nav-list">
        <li class="level1 nav-header">Related Projects</li>
        
          <li class="level2"><a href="https://typelevel.org/cats/">cats</a></li>
        
          <li class="level2"><a href="https://typelevel.org/cats-effect/">cats-effect</a></li>
        
          <li class="level2"><a href="https://fs2.io/">fs2</a></li>
        
          <li class="level2"><a href="https://github.com/armanbilge/fs2-dom/">fs2-dom</a></li>
        
          <li class="level2"><a href="https://http4s.github.io/http4s-dom/">http4s-dom</a></li>
        
      </ul>

    </nav>

    <div id="container">

      <nav id="page-nav">
        <p class="header"><a href="#">Core Concepts</a></p>

        <ul class="nav-list">
          <li class="level1"><a href="#components-and-resource-management">Components and resource management</a></li>
          <li class="level1"><a href="#signals">Signals</a></li>
          <li class="level1"><a href="#task-scheduling-and-glitch-free-rendering">Task scheduling and glitch-free rendering</a></li>
        </ul>

        <p class="footer"></p>
      </nav>

      <main class="content">

        <h1 id="core-concepts" class="title">Core Concepts</h1>
        <p>All of <strong>Calico</strong>’s core concepts are actually inherited from Cats Effect and FS2. This page highlights them and demonstrates how they are applied in the context of building web applications.</p>
        
        <h2 id="components-and-resource-management" class="section">Components and resource management<a class="anchor-link right" href="#components-and-resource-management"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>The most important idea behind <strong>Calico</strong> is that each component of your app (and in fact your app itself) should be expressed as a <code>Resource[IO, HtmlElement[IO]]</code>.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">dom</span><span>.*
</span><span class="comment">// note: no calico import yet!
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">component</span><span>: </span><span class="type-name">Resource</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">HtmlElement</span><span>[</span><span class="type-name">IO</span><span>]] = ???

</span><span class="comment">// or more generally:
</span><span class="keyword">def</span><span> </span><span class="declaration-name">component</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Dom</span><span>]: </span><span class="type-name">Resource</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">HtmlElement</span><span>[</span><span class="type-name">F</span><span>]] = ???</span></code></pre>
        <p>This <code>Resource</code> completely manages the lifecycle of that element and its children. When the <code>Resource</code> is allocated, it will create an instance of the <code>HtmlElement</code> and any supporting resources, such as background <code>Fiber</code>s or WebSocket connections. In kind, when the <code>Resource</code> is closed, these <code>Fiber</code>s and connections are canceled and released.</p>
        <p>Because <code>Resource[IO, HtmlElement[IO]]</code> is referentially-transparent, it naturally behaves as a &quot;builder&quot;. Your component can be re-used in multiple places in your application as well as un-mounted and re-mounted without worrying about crossed-wires or leaked resources. This makes it easy to compose components.</p>
        <p>So far, none of this is specific to <strong>Calico</strong>: we get all of this for free from Cats Effect and FS2 DOM. <strong>Calico</strong> provides an idiomatic DSL for describing components with standard HTML tags and attributes.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">calico</span><span>.</span><span class="identifier">html</span><span>.</span><span class="identifier">io</span><span>.{*, </span><span class="keyword">given</span><span>}
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">dom</span><span>.*

</span><span class="keyword">val</span><span> </span><span class="identifier">component</span><span>: </span><span class="type-name">Resource</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">HtmlElement</span><span>[</span><span class="type-name">IO</span><span>]] = </span><span class="identifier">div</span><span>(</span><span class="identifier">i</span><span>(</span><span class="string-literal">&quot;hello&quot;</span><span>), </span><span class="string-literal">&quot; &quot;</span><span>, </span><span class="identifier">b</span><span>(</span><span class="string-literal">&quot;world&quot;</span><span>))</span></code></pre>
        <p>Yes, in this very unexciting example <code>i(&quot;hello&quot;)</code> and <code>b(&quot;world&quot;)</code> are both <code>Resource</code>s that monadically compose with <code>div(...)</code> to create yet another <code>Resource</code>! There are no other resources involved in this very simple snippet. Also note that we have not yet <em>created</em> any <code>HtmlElement</code>s, we have merely created a <code>Resource</code> that <em>describes</em> how to make one.</p>
        <p>A more interesting example is this interactive Hello World demo.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">calico</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">calico</span><span>.</span><span class="identifier">html</span><span>.</span><span class="identifier">io</span><span>.{*, </span><span class="keyword">given</span><span>}
</span><span class="keyword">import</span><span> </span><span class="identifier">calico</span><span>.</span><span class="identifier">syntax</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">concurrent</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">dom</span><span>.*

</span><span class="keyword">val</span><span> </span><span class="identifier">component</span><span>: </span><span class="type-name">Resource</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">HtmlDivElement</span><span>[</span><span class="type-name">IO</span><span>]] =
  </span><span class="type-name">SignallingRef</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">of</span><span>(</span><span class="string-literal">&quot;world&quot;</span><span>).</span><span class="identifier">toResource</span><span>.</span><span class="identifier">flatMap</span><span> { </span><span class="identifier">name</span><span> =&gt;
    </span><span class="identifier">div</span><span>(
      </span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;Your name: &quot;</span><span>),
      </span><span class="identifier">input</span><span>.</span><span class="identifier">withSelf</span><span> { </span><span class="identifier">self</span><span> =&gt;
        (
          </span><span class="identifier">placeholder</span><span> := </span><span class="string-literal">&quot;Enter your name here&quot;</span><span>,
          </span><span class="comment">// here, input events are run through the given Pipe
</span><span>          </span><span class="comment">// this starts background fibers within the lifecycle of the &lt;input&gt; element
</span><span>          </span><span class="identifier">onInput</span><span> --&gt; (</span><span class="identifier">_</span><span>.</span><span class="identifier">foreach</span><span>(</span><span class="identifier">_</span><span> =&gt; </span><span class="identifier">self</span><span>.</span><span class="identifier">value</span><span>.</span><span class="identifier">get</span><span>.</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">name</span><span>.</span><span class="identifier">set</span><span>)))
        )
      },
      </span><span class="identifier">span</span><span>(
        </span><span class="string-literal">&quot; Hello, &quot;</span><span>,
        </span><span class="comment">// here, a Signal is rendered into the HTML
</span><span>        </span><span class="comment">// this starts background fibers within the life cycle of the &lt;span&gt; element
</span><span>        </span><span class="identifier">name</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">toUpperCase</span><span>)
      )
    )
  }</span></code></pre>
        <div id="mdoc-html-run3" data-mdoc-js></div>
        <p>The ideas are very much the same as the prior example.</p>
        <ol class="arabic">
          <li><code>input(...)</code> is a <code>Resource</code> that creates an <code>&lt;input&gt;</code> element and also manages <code>Fiber</code>s that handle input events. </li>
          <li><code>span(...)</code> is a <code>Resource</code> that creates a <code>&lt;span&gt;</code> element and also manages <code>Fiber</code>s that handle rendering of the name.</li>
          <li><code>div(...)</code> is a <code>Resource</code> composed of the <code>input(...)</code> and <code>span(...)</code> <code>Resource</code>s, and therefore (indirectly) manages the <code>Fiber</code>s of its child components.</li>
        </ol>
        <p>And there we have it: a self-contained component consisting of non-trivial resources, that can be safely used, reused, and torn down.</p>
        
        <h2 id="signals" class="section">Signals<a class="anchor-link right" href="#signals"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>In the Hello World demo above, we glossed over the <code>SignallingRef</code> used to hold the component’s state. A <code>SignallingRef</code> is a Cats Effect <code>Ref</code> (i.e. a mutable variable) that is also an FS2 <code>Signal</code>.</p>
        <p>A <code>Signal</code> is a time-varying value. You can always obtain its current value, and you may also subscribe to a stream of update events that notify when it is modified. This is ideal for use in UI components: they can always render immediately with the current value, and re-render only when there are updates.</p>
        <p><code>Signal</code> is a monad, enabling them to be transformed with pure functions and composed with each other. Using transformation and composition, you can derive a <code>Signal</code> that contains precisely the data you are interested in.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">calico</span><span>.</span><span class="identifier">frp</span><span>.</span><span class="keyword">given</span><span>

</span><span class="keyword">enum</span><span> </span><span class="type-name">Cardinal</span><span>:
  </span><span class="keyword">case</span><span> </span><span class="type-name">North</span><span>, </span><span class="type-name">South</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">signals</span><span> = (
  </span><span class="type-name">SignallingRef</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">of</span><span>(</span><span class="type-name">Option</span><span>.</span><span class="identifier">empty</span><span>[</span><span class="type-name">Cardinal</span><span>]),
  </span><span class="type-name">SignallingRef</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">of</span><span>(</span><span class="string-literal">&quot;&quot;</span><span>),
  </span><span class="type-name">SignallingRef</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">of</span><span>(</span><span class="string-literal">&quot;&quot;</span><span>),
).</span><span class="identifier">tupled</span><span>.</span><span class="identifier">toResource</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">app</span><span>: </span><span class="type-name">Resource</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">HtmlDivElement</span><span>[</span><span class="type-name">IO</span><span>]] =
  </span><span class="identifier">signals</span><span>.</span><span class="identifier">flatMap</span><span> { (</span><span class="identifier">cardinalSig</span><span>, </span><span class="identifier">northSig</span><span>, </span><span class="identifier">southSig</span><span>) =&gt;
    </span><span class="identifier">div</span><span>(
      </span><span class="identifier">div</span><span>(
        </span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;North input: &quot;</span><span>),
        </span><span class="identifier">input</span><span>.</span><span class="identifier">withSelf</span><span> { </span><span class="identifier">self</span><span> =&gt;
          </span><span class="identifier">onInput</span><span> --&gt; (</span><span class="identifier">_</span><span>.</span><span class="identifier">foreach</span><span>(</span><span class="identifier">_</span><span> =&gt; </span><span class="identifier">self</span><span>.</span><span class="identifier">value</span><span>.</span><span class="identifier">get</span><span>.</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">northSig</span><span>.</span><span class="identifier">set</span><span>)))
        },
      ),
      </span><span class="identifier">br</span><span>(()),
      </span><span class="identifier">div</span><span>(
        </span><span class="identifier">select</span><span>.</span><span class="identifier">withSelf</span><span> { </span><span class="identifier">self</span><span> =&gt;
          (
            </span><span class="identifier">option</span><span>(</span><span class="identifier">disabled</span><span> := </span><span class="boolean-literal">true</span><span>, </span><span class="identifier">selected</span><span> := </span><span class="boolean-literal">true</span><span>, </span><span class="string-literal">&quot;Select input&quot;</span><span>),
            </span><span class="identifier">option</span><span>(</span><span class="identifier">value</span><span> := </span><span class="string-literal">&quot;north&quot;</span><span>, </span><span class="string-literal">&quot;North&quot;</span><span>),
            </span><span class="identifier">option</span><span>(</span><span class="identifier">value</span><span> := </span><span class="string-literal">&quot;south&quot;</span><span>, </span><span class="string-literal">&quot;South&quot;</span><span>),
            </span><span class="identifier">onChange</span><span> --&gt; (
              </span><span class="identifier">_</span><span>.</span><span class="identifier">foreach</span><span>(</span><span class="identifier">_</span><span> =&gt; </span><span class="identifier">self</span><span>.</span><span class="identifier">value</span><span>.</span><span class="identifier">get</span><span>.</span><span class="identifier">map</span><span> {
                </span><span class="keyword">case</span><span> </span><span class="string-literal">&quot;north&quot;</span><span> =&gt; </span><span class="type-name">Some</span><span>(</span><span class="type-name">Cardinal</span><span>.</span><span class="type-name">North</span><span>)
                </span><span class="keyword">case</span><span> </span><span class="string-literal">&quot;south&quot;</span><span> =&gt; </span><span class="type-name">Some</span><span>(</span><span class="type-name">Cardinal</span><span>.</span><span class="type-name">South</span><span>)
                </span><span class="keyword">case</span><span> </span><span class="identifier">_</span><span> =&gt; </span><span class="type-name">None</span><span>
              }.</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">cardinalSig</span><span>.</span><span class="identifier">set</span><span>(</span><span class="identifier">_</span><span>)))
            )
          )
        },
        </span><span class="string-literal">&quot; &quot;</span><span>,
        </span><span class="comment">// compose cardinal signal with appropriate input signal
</span><span>        (</span><span class="identifier">cardinalSig</span><span>: </span><span class="type-name">Signal</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Option</span><span>[</span><span class="type-name">Cardinal</span><span>]]).</span><span class="identifier">flatMap</span><span> {
          </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="type-name">Cardinal</span><span>.</span><span class="type-name">North</span><span>) =&gt; </span><span class="identifier">northSig</span><span>
          </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="type-name">Cardinal</span><span>.</span><span class="type-name">South</span><span>) =&gt; </span><span class="identifier">southSig</span><span>
          </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span> =&gt; </span><span class="type-name">Signal</span><span>.</span><span class="identifier">constant</span><span>(</span><span class="string-literal">&quot;&quot;</span><span>)
        }
      ),
      </span><span class="identifier">br</span><span>(()),
      </span><span class="identifier">div</span><span>(
        </span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;South input: &quot;</span><span>),
        </span><span class="identifier">input</span><span>.</span><span class="identifier">withSelf</span><span> { </span><span class="identifier">self</span><span> =&gt;
          </span><span class="identifier">onInput</span><span> --&gt; (</span><span class="identifier">_</span><span>.</span><span class="identifier">foreach</span><span>(</span><span class="identifier">_</span><span> =&gt; </span><span class="identifier">self</span><span>.</span><span class="identifier">value</span><span>.</span><span class="identifier">get</span><span>.</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">southSig</span><span>.</span><span class="identifier">set</span><span>)))
        },
      ),
    )
  }</span></code></pre>
        <div id="mdoc-html-run5" data-mdoc-js></div>
        <p>There are various ways to obtain a <code>Signal</code>.</p>
        <ul>
          <li>
            <p>Create a <code>SignallingRef</code> with an initial value.</p>
            <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">SignallingRef</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">of</span><span>(</span><span class="string-literal">&quot;initial value&quot;</span><span>)</span></code></pre>
          </li>
          <li>
            <p>Derive a <code>Signal</code> from a <code>Stream</code>, by “holding” its latest value.</p>
            <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">stringStream</span><span>: </span><span class="type-name">Stream</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">String</span><span>] = ???
</span><span class="identifier">stringStream</span><span>.</span><span class="identifier">holdResource</span><span>(</span><span class="string-literal">&quot;initial value&quot;</span><span>)
</span><span class="identifier">stringStream</span><span>.</span><span class="identifier">holdOptionResource</span><span> </span><span class="comment">// use None for the intitial value</span></code></pre>
          </li>
        </ul>
        
        <h2 id="task-scheduling-and-glitch-free-rendering" class="section">Task scheduling and glitch-free rendering<a class="anchor-link right" href="#task-scheduling-and-glitch-free-rendering"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>A JavaScript webapp typically has a flow like:</p>
        <ol class="arabic">
          <li>
            An event fires. Examples:
            <ul>
              <li>a user event, such a button click</li>
              <li>a scheduled timer event</li>
              <li>an I/O event, such as an HTTP response or WebSocket message</li>
            </ul>
          </li>
          <li>An event handler is triggered, starting (potentially concurrent) tasks to update the application state and the UI. These tasks may also setup new event emitters, for example by scheduling timers or initiating an HTTP request.</li>
          <li>The UI re-renders.</li>
        </ol>
        <p><strong>Calico</strong> is highly-optimized for this pattern and by default schedules all tasks as so-called <em>microtasks</em>. These microtasks have very high-priority: while there is still work to be done, the UI will not re-render and no further events will be processed. Only once all microtasks are complete, will the UI re-render and events will start being processed again.</p>
        <p>Notice that this scheduling strategy guarantees glitch-free rendering. Because all tasks triggered by an event must complete before the view re-renders, the user will never see inconsistent state in the UI.</p>
        <p>However, there are certain situations where you may want the browser to re-render in the middle of a task. In these cases, simply sequence an <code>IO.cede</code> operation. This will temporarily yield control flow back to the browser so that it may re-render the UI, before resuming the task.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">updateComponentA</span><span> *&gt; </span><span class="comment">// doesn&#39;t render yet
</span><span>  </span><span class="identifier">updateComponentB</span><span> *&gt; </span><span class="comment">// still didn&#39;t render
</span><span>  </span><span class="type-name">IO</span><span>.</span><span class="identifier">cede</span><span> *&gt; </span><span class="comment">// re-render now
</span><span>  </span><span class="identifier">doOtherStuff</span><span> *&gt; ... </span><span class="comment">// do non-view-related work</span></code></pre>
        <p>Explicitly inserting an <code>IO.cede</code> can be a useful strategy to improve your app’s UX, by re-rendering as soon as you are done updating the view, and deferring other work until after the re-render. This will make your UI more responsive.</p>
        <p>To learn more I recommend <a href="https://javascript.info/event-loop">this article about the JavaScript event loop</a>.
        <script type="text/javascript" src="concepts.md.js" defer></script>
        <script type="text/javascript" src="mdoc.js" defer></script></p>

        <hr style="margin-top: 30px"/>
        <footer style="font-size: 90%; text-align: center">
          calico is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">Apache-2.0</a> license.
        </footer>

      </main>

    </div>

  </body>
</html>
